<div class="flex items-center justify-between w-full">
  <h1 class="font-extrabold"><%= election.title %></h1>
  <p class="text-gray-500">
    Created on <%= new Date(election.createdAt).toLocaleString() %>
  </p>
</div>
<p class="text-gray-400 text-lg"><%= election.description %></p>
<div class="flex items-center justify-between">
  <div class="flex">
    <a href="/election/<%= election.id %>/questions" class="btn mr-2"
      >Manage Questions</a
    >
    <a href="/election/<%= election.id %>/voters" class="btn mr-2"
      >Manage Voters</a
    >
  </div>
  <div class="flex flex-col items-center gap-2">
    <form action="/election/<%= election.id %>/toggleStatus" id="toggleStatus">
      <button type="submit" class="btn btn-primary mr-2 flex items-center">
        <% if (election.status === 'inactive') { %>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-6 h-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z"
          /></svg
        >&nbsp;Launch <% } else if (election.status === 'active') { %>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-6 h-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 019 14.437V9.564z"
          /></svg
        >&nbsp;End <% } %> Election
      </button>
    </form>
    <button
      onclick="return deleteElection(event, '<%= election.id %>')"
      class="btn bg-red-500 hover:bg-red-800 flex items-center justify-around"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-6 h-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m6 4.125l2.25 2.25m0 0l2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"
        />
      </svg>
      &nbsp; Delete Election
    </button>
  </div>
  <script>
    const toggleStatus = document.getElementById("toggleStatus");
    toggleStatus.addEventListener("submit", (e) => {
      e.preventDefault();
      const data = JSON.stringify({
        _csrf: "<%= csrfToken %>",
      });
      fetch(toggleStatus.action, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: data,
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.message) {
            location.reload();
          } else {
            alert(data.error);
          }
        })
        .catch((err) => console.log(err));
    });

    const deleteElection = (e, id) => {
      e.preventDefault();
      if (!confirm("Are you sure you want to delete this election?")) {
        return;
      }
      const data = JSON.stringify({
        _csrf: "<%= csrfToken %>",
      });
      fetch(`/election/${id}`, {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
        },
        body: data,
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.message) {
            window.location.href = "/elections";
          } else {
            alert(data.error);
          }
        })
        .catch((err) => console.log(err));
    };
  </script>
</div>
